---
title: "Customizing the look of your table"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

To customize the appearance of tables, `modelsummary` supports four of the most popular table-making packages: 

1. [`gt` documentation: https://gt.rstudio.com](https://gt.rstudio.com)
2. [`kableExtra` documentation: http://haozhu233.github.io/kableExtra](http://haozhu233.github.io/kableExtra)
3. [`huxtable` documentation: https://hughjonesd.github.io/huxtable/](https://hughjonesd.github.io/huxtable/)
4. [`flextable` documentation: https://davidgohel.github.io/flextable/](https://davidgohel.github.io/flextable/)

Users are encouraged to visit these websites to determine which package suits their needs best. Each of them has different strengths and weaknesses. For instance, `gt` allows seamless integration with the RStudio IDE, but `kableExtra`'s LaTeX (and PDF) output is far more mature.

# Post-processing

To create customized tables, the analyst begins by calling `msummary(models)` to create a summary table. Then, she *post-processes* the table by applying functions from one of the packages listed above. It is often convenient to use the `%>%` operator to do this.

To illustrate, we download data from the [Rdatasets repository](https://vincentarelbundock.github.io/Rdatasets') and we estimate 5 models:

```{r}
library(modelsummary)

url <- 'https://vincentarelbundock.github.io/Rdatasets/csv/HistData/Guerry.csv'
dat <- read.csv(url)

models <- list()
models[['OLS 1']] <- lm(Donations ~ Literacy + Clergy, data = dat)
models[['Poisson 1']] <- glm(Donations ~ Literacy + Commerce, family = poisson, data = dat)
models[['OLS 2']] <- lm(Crime_pers ~ Literacy + Clergy, data = dat)
models[['Poisson 2']] <- glm(Crime_pers ~ Literacy + Commerce, family = poisson, data = dat)
models[['OLS 3']] <- lm(Crime_prop ~ Literacy + Clergy, data = dat)
```

Then, we call `msummary()`, and we use the `tab_spanner` function from `gt` to add a spanning title which identifies the dependent variable in the first two models:

```{r, eval=FALSE}
library(gt)
msummary(models) %>%
    tab_spanner(label = 'Donations', columns = c('OLS 1', 'Poisson 1'))
```

By default, `modelsummary` produces an HTML table compatible with the `gt` package. If users want to use customization functions from a different package, they can simply specify the output format they need. For example, the `add_header_above` function from the `kableExtra` package adds column spanning labels:

```{r, eval=FALSE}
library(kableExtra)
msummary(models, output = 'kableExtra') %>%
    add_header_above(c(" " = 1, "Donations" = 2, " " = 3))
```

The default output format can be changed by setting a global option:

```{r, eval=FALSE}
options(modelsummary_default = 'kableExtra')
```

## Warning: post-processing and the `output` argument

When users supply a file name to the `output` argument, the table is written immediately to file. This means that users cannot post-process and customize the resulting table using functions from `gt`, `kableExtra`, `huxtable`, or `flextable`. When users specify a filename in the `output` argument, the `msummary()` call should be the *final* one in the chain.

This is OK:

```{r, eval=FALSE}
msummary(models, output = 'table.html')
```

This is **not** OK:

```{r, eval=FALSE}
msummary(models, output = 'table.html') %>%
    tab_spanner(label = 'Literacy', columns = c('OLS 1', 'Poisson 1'))
```

To save a customized table, you should apply all the customization functions you need before saving it using `gt::gtsave`, `kableExtra::save_kable`, or the appropriate helper function from the package that you are using to customize your table.
 
# `gt`

```{r}
library(gt)
```

## Fonts, colors, and styles

Thanks to `gt`, `modelsummary` accepts markdown indications for emphasis and more:

```r
msummary(models, 
         title = md('This is a **bolded series of words.**'),
         notes = list(md('And an *emphasized note*.')))
```

We can modify the size of the text with `gt`'s `tab_style` function: 

```r
msummary(models) %>%
    tab_style(style = cell_text(size = 'x-large'),
              locations = cells_body(columns = 1)) 
```

We can also color columns and cells, and present values in bold or italics:

```{r}
msummary(models) %>%
    tab_style(style = cell_fill(color = "lightcyan"), 
              locations = cells_body(columns = vars(`OLS 1`))) %>% 
    tab_style(style = cell_fill(color = "#F9E3D6"),
              locations = cells_body(columns = vars(`Poisson 2`), rows = 2:6)) %>%
    tab_style(style = cell_text(weight = "bold"), 
              locations = cells_body(columns = vars(`OLS 1`))) %>%
    tab_style(style = cell_text(style = "italic"), 
              locations = cells_body(columns = vars(`Poisson 2`), rows = 2:6))
```

## Column groups

Create spanning labels to group models (columns):

```r
msummary(models) %>%
    tab_spanner(label = 'Literacy', columns = c('OLS 1', 'Poisson 1')) %>%
    tab_spanner(label = 'Desertion', columns = c('OLS 2', 'Poisson 2')) %>%
    tab_spanner(label = 'Clergy', columns = 'OLS 3')
```

## Images

Insert images in your tables using the `gt::text_transform` and `gt::local_image` functions.

```{r}
f <- function(x) web_image(url = "https://user-images.githubusercontent.com/987057/82732352-b9aabf00-9cda-11ea-92a6-26750cf097d0.png", height = 80)

msummary(models) %>%
    text_transform(locations = cells_body(columns = 2:6, rows = 1), fn = f)
```

## Complex example

This is the code I used to generate the "complex" table posted at the top of this README.

```r
cm <- c('Literacy' = 'Literacy (%)',
        'Clergy' = 'Priests/capita',
        'Commerce' = 'Patents/capita', 
        'Infants' = 'Infants',
        '(Intercept)' = 'Constant')

msummary(models,
         coef_map = cm,
         stars = TRUE,
         gof_omit = "Deviance",
         title = 'modelsummary package for R',
         notes = c('The most important parameter is printed in red.')) %>%
    tab_spanner(label = 'Donations', columns = 2:3) %>%
    tab_spanner(label = 'Crimes (persons)', columns = 4:5) %>%
    tab_spanner(label = 'Crimes (property)', columns = 6) %>%
    tab_footnote(footnote = md("Very **important** variable."),
                 locations = cells_body(rows = 3, columns = 1)) %>%
    tab_style(style = cell_text(color = 'red'),
              locations = cells_body(rows = 3, columns = 4))
```

<img src="https://user-images.githubusercontent.com/987057/82853752-90558300-9ed4-11ea-88af-12cf20cb367f.png" width="40%">

# `kableExtra`

```{r}
library(kableExtra)
```

The `gt` LaTeX render engine is still immature. Until it improves, I strongly recommend that users turn to `kableExtra` to produce LaTeX tables. This package offers robust functions that allow a lot of customization. A simple LaTeX table can be produced as follows:

```r
msummary(models, output = 'latex')
```

`kableExtra` also produces very nice HTML tables. We can use functions from this package to customize this table, with bold and colored cells, column spans, and more. 

## Fonts, colors and styles

The `row_spec` and `column_spec` allow users to change the styling of their tables. For instance, this code creates a table where the first column is in bold blue text on pink background:

```r
msummary(models, output = 'latex') %>%
    row_spec(1, bold = TRUE, color = 'blue', background = 'pink')
```

## Column groups

You can define column group labels using `kableExtra`'s `add_header_above` function:

```
msummary(models, output = 'latex') %>%
    add_header_above(c(" " = 1, 
                       "Donations" = 2, 
                       "Crimes (person)" = 2, 
                       "Crimes (property)" = 1))
```

## Complex example

```r
cm <- c('Literacy' = 'Literacy (%)',
        'Clergy' = 'Priests/capita',
        'Commerce' = 'Patents/capita',
        'Infants' = 'Infants',
        '(Intercept)' = 'Constant')

msummary(models,
    coef_map = cm,
    stars = TRUE,
    gof_omit = "Deviance",
    title = 'modelsummary package for R',
    notes = c('First custom note to contain text.',
              'Second custom note with different content.')) %>%
    add_header_above(c(" " = 1, 
                       "Donations" = 2, 
                       "Crimes (person)" = 2, 
                       "Crimes (property)" = 1))
   row_spec(3, bold = TRUE, color = 'blue', background = 'pink')
```

<img src="https://user-images.githubusercontent.com/987057/82732382-e068f580-9cda-11ea-8924-331550f8f1e8.png" width="40%">

# `huxtable`

TODO: Contributions welcome!

# `flextable`

TODO: Contributions welcome!
