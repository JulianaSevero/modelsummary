---
title: "Balance table with test statistics"
output:
  html_document: default
---

```{r, message=FALSE}
library(modelsummary)
library(tidyverse)
library(estimatr)
library(kableExtra)
options(modelsummary_default = 'kableExtra')

# Download and clean data
url <- 'https://vincentarelbundock.github.io/Rdatasets/csv/palmerpenguins/penguins.csv'
penguins <- read.csv(url) %>%
            mutate(Sex = str_to_title(sex)) %>%
            select(`Body mass (g)` = body_mass_g,
                   `Culmen depth (mm)` = culmen_depth_mm,
                   `Culmen length (mm)` = culmen_length_mm,
                   `Flipper length (mm)` = flipper_length_mm,
                   Island = island,
                   Species = species,
                   Sex) %>%
            filter(!is.na(Sex))

# Calculate difference in means for 4 numeric variables
compute_dim <- function(variable, condition = 'Sex', data = penguins) {
    paste0('`', variable, '`~', condition) %>%
           formula %>%
           difference_in_means(data = data) %>%
           tidy %>%
           select(`Diff. in Means` = estimate,
                  `Std.Error` = std.error,
                  `p Value` = p.value)
}
new_cols <- c("Body mass (g)", "Culmen depth (mm)", 
              "Culmen length (mm)", "Flipper length (mm)") %>%
            map_df(compute_dim)

# Create a balance table
datasummary_table1(~Sex, data = penguins, add_columns = new_cols,
                   align = 'llrlrlrrr') %>%
    row_spec(5, bold = TRUE)
```
